@model Smart_Invoice.Models.Sales.SalesInvoice
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@{
    ViewData["Title"] = "Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h1>Details</h1>

<div class="container card">
    <h4 class="mb-4">SalesInvoice</h4>
    <button id="GeneratePDF" itemid="@Model.Id">View PDF</button>
    <hr class="mb-4">
    <div class="row">
        <div class="col-md-6">
            <dl class="row">
                <dt class="col-sm-4">Invoice Number</dt>
                <dd class="col-sm-8">@Html.DisplayFor(model => model.Invoice_number)</dd>

                <dt class="col-sm-4">Issue Date</dt>
                <dd class="col-sm-8">@Html.DisplayFor(model => model.IssueDate)</dd>

                <dt class="col-sm-4">Due Date</dt>
                <dd class="col-sm-8">@Html.DisplayFor(model => model.DueDate)</dd>

                <dt class="col-sm-4">Discount</dt>
                <dd class="col-sm-8">@Html.DisplayFor(model => model.Discount)</dd>

                <dt class="col-sm-4">Subtotal</dt>
                <dd class="col-sm-8">@Html.DisplayFor(model => model.SubTotal)</dd>
            </dl>
        </div>
        <div class="col-md-6">
            <dl class="row">
                <dt class="col-sm-4">Tax</dt>
                <dd class="col-sm-8">@Html.DisplayFor(model => model.Tax)</dd>

                <dt class="col-sm-4">Total</dt>
                <dd class="col-sm-8">@Html.DisplayFor(model => model.Total)</dd>

                <dt class="col-sm-4">Amount Paid</dt>
                <dd class="col-sm-8">@Html.DisplayFor(model => model.AmountPaid)</dd>

                <dt class="col-sm-4">Balance Due</dt>
                <dd class="col-sm-8">@Html.DisplayFor(model => model.BalanceDue)</dd>

                <dt class="col-sm-4">Notes</dt>
                <dd class="col-sm-8">@Html.DisplayFor(model => model.Notes)</dd>
            </dl>
        </div>
        <div class="card-body">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Product Id</th>
                        <th>Product Name</th>
                        <th>Quantity</th>
                        <th>Unit Price</th>
                        <th>Discount</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.Products)
                    {
                        <tr>
                            <td>@item.productId</td>
                            <td>@item.Name</td>
                            <td>@item.Quantity</td>
                            <td>@item.UnitPrice</td>
                            <td>@item.Discount</td>
                            <td>@item.Total</td>
                        </tr>
                    }
                </tbody>
            </table>

        </div>
    </div>
</div>


<div>
    <a asp-action="Edit" asp-route-id="@Model?.Id">Edit</a> |
    <a asp-action="Index">Back to List</a>
</div>
@section Scripts{
    <script src="https://cdn.jsdelivr.net/npm/itext-js@3.1.3/dist/itext.bundle.min.js"></script>
    <script>
        $("#GeneratePDF").click(function(event){
            event.preventDefault();
            var itemId = $(this).attr('itemid');
            console.log(itemId);
            $.ajax({
                url:'/Accountant/SalesInvoices/GetInvoicePdf',
                method:'GET',
                data: {id : itemId},
                success:function(data){
                     var win = window.open();
                     win.document.write('<embed width="100%" height="100%" src="data:application/pdf;base64,' + data + '" type="application/pdf" />');
                }
            })
        })
    </script>

}